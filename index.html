<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Behavioral Financial Allocator</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:#fbfdff;color:#111;margin:0;padding:24px}
    .wrap{max-width:980px;margin:0 auto}
    h1{margin:0;font-size:26px}
    h2{margin-top:24px;font-size:20px;color:#1f6feb}
    p, li{font-size:14px;line-height:1.5}
    ul{margin-top:4px;margin-bottom:12px}
    .card{background:#ffffff;border-radius:12px;padding:16px;box-shadow:0 6px 18px rgba(20,30,40,0.06);margin-top:12px}
    label{display:block;font-size:13px;color:#666;margin-bottom:6px}
    .slider-row{margin-bottom:20px}
    .slider-explanation{font-size:13px;color:#555;margin-bottom:8px;line-height:1.4}
    input[type=range]{width:100%}
    .small{font-size:13px;color:#666}
    button{background:#1f6feb;color:white;border:none;padding:10px 14px;border-radius:8px;cursor:pointer;margin-top:8px;margin-right:6px}
    .results{margin-top:10px;font-size:15px;line-height:1.4}
    .section-header{font-weight:600;font-size:15px;color:#1f6feb;margin-top:24px;margin-bottom:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Behavioral Financial Allocator</h1>
    </header>

    <!-- Intro -->
    <div class="card">
      <p>This interactive tool helps you plan how to allocate your discretionary income between <strong>Investing</strong>, <strong>Debt repayment</strong>, and <strong>Savings</strong>. It combines financial calculations with behavioral considerations, aiming to balance long-term net worth optimization with your current needs and priorities.</p>
    </div>

    <!-- Sliders with inline explanations -->
    <div class="card">
      <div id="sliders"></div>
      <button onclick="update()">Run Projection</button>
      <button onclick="resetDefaults()" style="background:#e6e9ef;color:#111">Reset</button>
      <div class="results" id="results"></div>
    </div>

    <!-- Pie chart and summary -->
    <div class="card">
      <div id="piechart" style="width:100%;height:360px"></div>
      <div id="summary" style="margin-top:12px"></div>
    </div>
  </div>

<script>
/* -------------------------------
   Behavioral allocation (JS)
   ------------------------------- */

function behavioralAllocation(params){
  const {income, expenses, minDebtPayment, rInvest, rDebt, rSave, RT, DA, pInvest, pDebt, pSave, alpha, beta, delta, gammaDebt, gammaSave, k, goalStrength} = params;
  const discretionary = income - expenses - minDebtPayment;
  if (discretionary <= 0) return {allocations:{Invest:0,Debt:0,Save:0},discretionary};
  const rPercInvest = rInvest * (1 + alpha * (2*RT - 1));
  const rPercDebt = rDebt * (1 + beta * (2*DA - 1)) + gammaDebt*DA;
  const rPercSave = rSave * (1 + delta * (1 - RT)) + gammaSave*(1 - RT);
  const rates = [rPercInvest, rPercDebt, rPercSave];
  const expVals = rates.map(r => Math.exp(k*r));
  const sumExp = expVals.reduce((a,b)=>a+b,0);
  const base = expVals.map(v=>v/sumExp);
  const P = [pInvest,pDebt,pSave];
  const boosted = base.map((b,i)=> b + P[i]*goalStrength);
  const sumBoost = boosted.reduce((a,b)=>a+b,0);
  const finalW = boosted.map(x=>x/sumBoost);
  return {allocations:{Invest: finalW[0]*discretionary, Debt: finalW[1]*discretionary, Save: finalW[2]*discretionary}, discretionary};
}

function projectNetWorth(params){
  const res = behavioralAllocation(params);
  const alloc = res.allocations; const discretionary = res.discretionary;
  let invest = params.initialInvest, save = params.initialSavings, debt = params.initialDebt;
  const months = params.years*12;
  for (let m=0;m<months;m++){
    invest = invest*(1 + params.rInvest/12) + alloc.Invest;
    save = save*(1 + params.rSave/12) + alloc.Save;
    debt = Math.max(0, debt*(1 + params.rDebt/12) - alloc.Debt);
  }
  const netWorth = invest + save - debt;
  return {alloc, discretionary, invest, save, debt, netWorth};
}

function monthsToDebtFree(balance, apr, payment){
  let months = 0; while (balance>0 && payment>0 && months<1000){ balance = balance*(1+apr/12) - payment; months++; } return months;
}

/* -------------------------------
   UI: sliders generation
   ------------------------------- */

const defaults = {
  income:4000, expenses:2200, minDebtPayment:300,
  rInvest:0.08, rDebt:0.06, rSave:0.015,
  RT:0.5, DA:0.5,
  pInvest:0.33, pDebt:0.33, pSave:0.33,
  years:10,
  initialInvest:0, initialSavings:0, initialDebt:50000
};

const sliderDefinitions = [
  ["income","Monthly Income",defaults.income,1000,15000,100,"Your total monthly income before expenses."],
  ["expenses","Monthly Expenses",defaults.expenses,500,12000,50,"Your regular monthly expenses (rent, utilities, groceries, etc.)."],
  ["minDebtPayment","Minimum Debt Payment",defaults.minDebtPayment,0,2000,10,"The minimum you must pay on debts each month."],
  
  ["rInvest","Investment Return",defaults.rInvest,0,0.15,0.005,"Expected annual return on investments (e.g., 8% for stock market average)."],
  ["rDebt","Debt Interest Rate",defaults.rDebt,0,0.15,0.005,"Average annual interest rate on your debts."],
  ["rSave","Savings Rate",defaults.rSave,0,0.05,0.001,"Expected annual return on savings (e.g., 1.5% for high-yield savings)."],
  
  ["RT","Risk Tolerance",defaults.RT,0,1,0.01,"How comfortable you are with investment risk. Higher values favor more aggressive investing."],
  ["DA","Debt Aversion",defaults.DA,0,1,0.01,"How strongly you prefer paying down debt quickly. Higher values favor faster repayment."],
  
  ["pInvest","Invest Priority",defaults.pInvest,0,1,0.01,"Your personal priority weight for investing vs other goals."],
  ["pDebt","Debt Priority",defaults.pDebt,0,1,0.01,"Your personal priority weight for debt repayment vs other goals."],
  ["pSave","Save Priority",defaults.pSave,0,1,0.01,"Your personal priority weight for saving vs other goals."],
  
  ["years","Projection Years",defaults.years,1,50,1,"Number of years to project your net worth into the future."],
  
  ["initialInvest","Existing Investments",defaults.initialInvest,0,200000,1000,"Current value of your investment accounts."],
  ["initialSavings","Existing Savings",defaults.initialSavings,0,200000,1000,"Current value of your savings accounts."],
  ["initialDebt","Total Debt",defaults.initialDebt,0,200000,1000,"Total amount of debt you currently have."]
];

const sections = [
  {title: "Monthly Income & Expenses", start: 0, end: 3},
  {title: "Expected Rates", start: 3, end: 6},
  {title: "Behavioral Preferences", start: 6, end: 11},
  {title: "Timeline", start: 11, end: 12},
  {title: "Existing Balances", start: 12, end: 15}
];

function makeSliders(){
  const container = document.getElementById('sliders');
  let currentSection = -1;
  
  sliderDefinitions.forEach(([id,label,val,min,max,step,explanation], idx)=>{
    // Check if we need a section header
    for (let i = 0; i < sections.length; i++) {
      if (idx === sections[i].start) {
        const sectionHeader = document.createElement('div');
        sectionHeader.className = 'section-header';
        sectionHeader.innerText = sections[i].title;
        container.appendChild(sectionHeader);
        break;
      }
    }
    
    const row = document.createElement('div'); 
    row.className='slider-row';
    
    const labelEl = document.createElement('label'); 
    labelEl.innerText = label; 
    row.appendChild(labelEl);
    
    if (explanation) {
      const explainEl = document.createElement('div');
      explainEl.className = 'slider-explanation';
      explainEl.innerText = explanation;
      row.appendChild(explainEl);
    }
    
    const valueSpan = document.createElement('div'); 
    valueSpan.className='small'; 
    valueSpan.id = id + '_val'; 
    valueSpan.innerText = val; 
    row.appendChild(valueSpan);
    
    const input = document.createElement('input'); 
    input.type='range'; 
    input.id=id; 
    input.min=min; 
    input.max=max; 
    input.step=step; 
    input.value=val;
    input.oninput = ()=> document.getElementById(id + '_val').innerText = input.value;
    row.appendChild(input);
    
    container.appendChild(row);
  });
}
makeSliders();

function getParams(){
  const p = {};
  sliderDefinitions.forEach(([id])=> p[id] = Number(document.getElementById(id).value));
  p.alpha = 0.5; p.beta = 0.5; p.delta = 0.5; p.gammaDebt = 0.02; p.gammaSave = 0.01; p.k = 20; p.goalStrength = 0.1;
  return p;
}

function resetDefaults(){
  sliderDefinitions.forEach(([id,_,val])=>{ document.getElementById(id).value = val; document.getElementById(id + '_val').innerText = val; });
  update();
}

function update(){
  const params = getParams();
  const out = projectNetWorth(params);
  const monthsMin = monthsToDebtFree(params.initialDebt, params.rDebt, params.minDebtPayment);
  const monthsExtra = monthsToDebtFree(params.initialDebt, params.rDebt, params.minDebtPayment + out.alloc.Debt);

  document.getElementById('results').innerHTML = `
    <strong>Discretionary:</strong> $${out.discretionary.toFixed(0)}<br><br>
    <strong>Monthly allocations</strong><br>
    Invest: $${out.alloc.Invest.toFixed(0)}<br>
    Debt: $${out.alloc.Debt.toFixed(0)}<br>
    Save: $${out.alloc.Save.toFixed(0)}<br><br>
    <strong>Projection after ${params.years} years</strong><br>
    Investment: $${out.invest.toFixed(0)}<br>
    Savings: $${out.save.toFixed(0)}<br>
    Debt remaining: $${out.debt.toFixed(0)}<br>
    Net worth: <strong>$${out.netWorth.toFixed(0)}</strong>
  `;

  document.getElementById('summary').innerHTML = `
    <div class="small">ðŸ“‰ Debt payoff (min only): ${monthsMin} months (${(monthsMin/12).toFixed(1)} yrs)</div>
    <div class="small">ðŸ“‰ Debt payoff (with extra): ${monthsExtra} months (${(monthsExtra/12).toFixed(1)} yrs)</div>
  `;

  Plotly.newPlot('piechart',[{values:[out.alloc.Invest,out.alloc.Debt,out.alloc.Save],labels:['Invest','Debt','Save'],type:'pie'}],{margin:{t:0}});
}

// initial render
update();
</script>
</body>
</html>